{% from "macros.html" import pagination, show_on_load %}
{% from "decks/macros.html" import deck_details %}
{% extends "base.html" %}
{% block title %}{{ 'Public Decks' | paged_title(page) }}{% endblock %}
{% block page_class %}sidebar-first deck-listing{% endblock %}

{% block heading %}
	<h1 class="phg-main-action">Public decks</h1>
{% endblock %}

{% block content %}
	{% if decks %}
	<ul class="deck-list">
	{% for deck in decks %}
		<li class="deck {{ deck.phoenixborn.stub }}">
			{{ deck_details(deck, card_map, current_user, history_view=0) }}
		</li>
	{% endfor %}
	</ul>
	{{ pagination('decks.index', pages, page=page, s=filters.s, phoenixborn=filters.phoenixborn) }}
	{% else %}
	<p class="callout">No decks found. <a href="{{ url_for('decks.index') }}" class="btn btn-primary">Reset filters</a></p>
	{% endif %}
{% endblock %}

{% block sidebar %}
	<form action="./" method="GET">
		<div class="input-group">
			<div class="form-field">
				<input type="text" placeholder="Filter by title..." id="searchbox" name="s" value="{{ filters.s | default('') }}">
			</div>
			<button class="btn clear-control" title="Clear Search" data-target-input="searchbox" id="clear-search-button"><i class="fa fa-times"></i></button>
		</div>
		<div class="form-field">
			<select name="phoenixborn">
				<option value="">Filter by Phoenixborn...</option>
				{% for card in phoenixborn %}
				<option value="{{ card.stub }}"{% if filters.phoenixborn == card.stub %} selected{% endif %}>{{ card.name }}</option>
				{% endfor %}
			</select>
		</div>
		<!-- <noscript> -->
			<input type="submit" value="Filter Decks" class="btn btn-block btn-primary">
		<!-- </noscript> -->
	</form>
	{{ show_on_load('clear-search-button') }}

	{% if precon_decks %}
	<hr>

	<h2>Preconstructed Decks</h2>

	<ul>
		{% for deck in precon_decks %}
		{% if not loop.last and (loop.index > 6 and loop.index % 2) %}</ul><hr><ul>{% endif %}
		<li>
			<span class="phoenixborn" title="{{ deck.phoenixborn.name }}">{{ deck.phoenixborn.name | first_name }}</span>: 
			<a href="{{ url_for('decks.view', deck_id=deck.source_id) }}">
				{{ deck.title }}
			</a>
		</li>
		{% endfor %}
	</ul>
	{% endif %}
{% endblock %}
